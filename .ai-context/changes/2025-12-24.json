{
  "timestamp": "2025-12-24_00-25-51",
  "commit": "33f897f2801614c615d94411f8f0606e0d0f91c2",
  "message": "Phase 4: Dual-write integration complete

- Add global kill switch (ENABLE_FIRESTORE_INGEST in BuildConfig)
- Add per-source toggle (Source.enableFirestoreIngest)
- Integrate IngestQueue into DataPipeline (non-blocking)
- Document CRM write flow + tooling health
- Builds pass (debug + release, zero errors)
- Ready for device testing

Files modified:
- android/app/build.gradle (global flag)
- android/app/src/main/java/com/example/alertsheets/domain/models/Source.kt (per-source toggle)
- android/app/src/main/java/com/example/alertsheets/domain/DataPipeline.kt (dual-write logic)

Docs created:
- PHASE_4_DUAL_WRITE_IMPLEMENTATION.md
- FIRESTORE_CRM_WRITE_FLOW.md
- TOOL_HEALTH_AND_FALLBACKS.md

Next: Device testing, Lab UI toggle",
  "files_changed": [
    ".ai-context/changes/2025-12-23.json",
    ".serena/.gitignore",
    ".serena/project.yml",
    "AUDIT_CRM_BASELINE.md",
    "AUDIT_INDEX.md",
    "BUILD_PROOF.md",
    "CARD_INDEPENDENCE_REPORT.md",
    "CARD_WIRING_MATRIX.md",
    "COMPREHENSIVE_AUDIT_SUMMARY.md",
    "CONCURRENCY_RISK.md",
    "DOC_INDEX - Copy.md",
    "DOC_INDEX.md",
    "EMAIL_FLOW_DECISION - Copy.md",
    "EMAIL_FLOW_DECISION.md",
    "EMAIL_FLOW_STATUS - Copy.md",
    "EMAIL_FLOW_STATUS.md",
    "EMAIL_STATUS - Copy.md",
    "FIRESTORE_CRM_SCHEMA - Copy.md",
    "FIRESTORE_CRM_WRITE_FLOW.md",
    "PHASE_3_DEPLOYMENT_COMPLETE.md",
    "PHASE_4_DUAL_WRITE_IMPLEMENTATION.md",
    "SEQUENCE_DIAGRAMS.md",
    "SERENA_PREREQUISITES_TEST - Copy.md",
    "TOOL_HEALTH_AND_FALLBACKS.md",
    "UI_VISIBILITY_FIX.md",
    "WORKFLOW_MAP.md",
    "_GITHUB_PUSH_COMPLETE.md",
    "android/.gradle/8.7/executionHistory/executionHistory.bin",
    "android/.gradle/8.7/executionHistory/executionHistory.lock",
    "android/.gradle/8.7/fileHashes/fileHashes.bin",
    "android/.gradle/8.7/fileHashes/fileHashes.lock",
    "android/.gradle/8.7/fileHashes/resourceHashesCache.bin",
    "android/.gradle/buildOutputCleanup/buildOutputCleanup.lock",
    "android/.gradle/file-system.probe",
    "android/app/build.gradle",
    "android/app/build/intermediates/compile_and_runtime_not_namespaced_r_class_jar/debug/R.jar",
    "android/app/build/intermediates/data_binding_layout_info_type_merge/debug/out/activity_main_dashboard-layout.xml",
    "android/app/build/intermediates/data_binding_layout_info_type_package/debug/out/activity_main_dashboard-layout.xml",
    "android/app/build/intermediates/dex/debug/mergeProjectDexDebug/0/classes.dex",
    "android/app/build/intermediates/dex/debug/mergeProjectDexDebug/15/classes.dex",
    "android/app/build/intermediates/dex/debug/mergeProjectDexDebug/3/classes.dex",
    "android/app/build/intermediates/dex/debug/mergeProjectDexDebug/4/classes.dex",
    "android/app/build/intermediates/dex/debug/mergeProjectDexDebug/7/classes.dex",
    "android/app/build/intermediates/dex_archive_input_jar_hashes/debug/out",
    "android/app/build/intermediates/incremental/debug/mergeDebugResources/compile-file-map.properties",
    "android/app/build/intermediates/incremental/debug/mergeDebugResources/merger.xml",
    "android/app/build/intermediates/incremental/debug/packageDebugResources/compile-file-map.properties",
    "android/app/build/intermediates/incremental/debug/packageDebugResources/merger.xml",
    "android/app/build/intermediates/incremental/packageDebug/tmp/debug/dex-renamer-state.txt",
    "android/app/build/intermediates/incremental/packageDebug/tmp/debug/zip-cache/androidResources",
    "android/app/build/intermediates/local_only_symbol_list/debug/R-def.txt",
    "android/app/build/intermediates/merged_res/debug/layout_activity_main_dashboard.xml.flat",
    "android/app/build/intermediates/merged_res/debug/values_values.arsc.flat",
    "android/app/build/intermediates/merged_res_blame_folder/debug/out/single/debug.json",
    "android/app/build/intermediates/merged_res_blame_folder/debug/out/single/layout.json",
    "android/app/build/intermediates/packaged_res/debug/layout/activity_main_dashboard.xml",
    "android/app/build/intermediates/packaged_res/debug/values/values.xml",
    "android/app/build/intermediates/processed_res/debug/out/resources-debug.ap_",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/AppConfigActivity.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/AppsListActivity.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/MigrationManager.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/SmsConfigActivity$onCreate$2.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/SmsConfigActivity.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/data/repositories/SourceRepository.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/domain/DataPipeline$process$1.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/domain/DataPipeline.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/domain/SourceManager.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/domain/models/Source.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/domain/models/SourceStats.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/domain/models/SourceType.dex",
    "android/app/build/intermediates/project_dex_archive/debug/out/com/example/alertsheets/ui/MainActivity.dex",
    "android/app/build/intermediates/runtime_symbol_list/debug/R.txt",
    "android/app/build/intermediates/stable_resource_ids_file/debug/stableIds.txt",
    "android/app/build/intermediates/symbol_list_with_package_name/debug/package-aware-r.txt",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/inputs/source-to-output.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/inputs/source-to-output.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-attributes.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-attributes.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-attributes.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-attributes.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-attributes.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-attributes.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-fq-name-to-source.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-fq-name-to-source.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-fq-name-to-source.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-fq-name-to-source.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-fq-name-to-source.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/class-fq-name-to-source.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/constants.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/constants.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/internal-name-to-source.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/internal-name-to-source.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/internal-name-to-source.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/internal-name-to-source.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/internal-name-to-source.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/internal-name-to-source.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/proto.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/proto.tab.values",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/proto.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/proto.tab.values.s",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/source-to-classes.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/source-to-classes.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/source-to-classes.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/source-to-classes.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/source-to-classes.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/source-to-classes.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/subtypes.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/subtypes.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/subtypes.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/subtypes.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/subtypes.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/subtypes.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/supertypes.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/supertypes.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/supertypes.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/supertypes.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/supertypes.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/jvm/kotlin/supertypes.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/counters.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/file-to-id.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/file-to-id.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/id-to-file.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/id-to-file.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/id-to-file.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/id-to-file.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/id-to-file.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/id-to-file.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab.keystream",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab.keystream.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab.len",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab.values",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab.values.at",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab.values.s",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/caches-jvm/lookups/lookups.tab_i",
    "android/app/build/kotlin/compileDebugKotlin/cacheable/last-build.bin",
    "android/app/build/kotlin/compileDebugKotlin/classpath-snapshot/shrunk-classpath-snapshot.bin",
    "android/app/build/kotlin/compileDebugKotlin/local-state/build-history.bin",
    "android/app/build/outputs/apk/debug/app-debug.apk",
    "android/app/build/tmp/compileDebugJavaWithJavac/previous-compilation-data.bin",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/AppConfigActivity.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/AppsListActivity.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/MigrationManager.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/SmsConfigActivity$onCreate$2.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/SmsConfigActivity.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/data/repositories/SourceRepository.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/domain/DataPipeline$process$1.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/domain/DataPipeline.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/domain/SourceManager.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/domain/models/Source.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/domain/models/SourceStats.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/domain/models/SourceType.class",
    "android/app/build/tmp/kotlin-classes/debug/com/example/alertsheets/ui/MainActivity.class",
    "android/app/src/main/java/com/example/alertsheets/domain/DataPipeline.kt",
    "android/app/src/main/java/com/example/alertsheets/domain/models/Source.kt",
    "android/app/src/main/java/com/example/alertsheets/ui/MainActivity.kt",
    "android/app/src/main/res/drawable/bg_card_blue.xml",
    "android/app/src/main/res/drawable/bg_card_elevated.xml",
    "android/app/src/main/res/drawable/bg_card_orange.xml",
    "android/app/src/main/res/drawable/bg_card_purple.xml",
    "android/app/src/main/res/layout/activity_lab.xml",
    "android/app/src/main/res/layout/activity_main_dashboard.xml",
    "android/app/src/main/res/layout/dialog_create_source.xml",
    "android/app/src/main/res/values/colors.xml",
    "functions/lib/enrichment.js",
    "functions/lib/enrichment.js.map",
    "functions/lib/index.js",
    "functions/lib/index.js.map",
    "functions/lib/utils/addressUtils.js",
    "functions/lib/utils/addressUtils.js.map",
    "functions/lib/utils/featureFlags.js",
    "functions/lib/utils/featureFlags.js.map",
    "users.json"
  ]
}
